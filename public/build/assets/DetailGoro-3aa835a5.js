import{W as H,r,j as a,a as m,R as I,b as x}from"./app-b50086a9.js";import{F as l}from"./FormatNumbering-7365626e.js";import{u as K,T as U,a as V,b as n,c as y,f as d,d as $,e as g,i as G,g as k}from"./index-2697d2db.js";import{F as L}from"./index.esm-80f4d9c8.js";import W from"./DetailPerUnitGoro-f4e82029.js";import q from"./Create-2b7633de.js";import"./react-number-format.es-10316b38.js";import"./utils-01642ffa.js";import"./iconBase-c53f902e.js";import"./dayjs.min-c8f65d28.js";import"./dialog-a373bc2c.js";import"./InputLabel-4e5e0d1c.js";import"./TextInput-46faa701.js";import"./index.esm-45d046e3.js";import"./InputError-4f330d83.js";import"./PrimaryButton-7989bded.js";import"./Loading-bd51b4e5.js";import"./transition-cb84201b.js";const me=({triggerId:s})=>{const{server_filter:N}=H().props,[T,C]=r.useState([]),[w,p]=r.useState(!0),[i,_]=r.useState(),[u,v]=r.useState({totalNominal:0,totalPembayaran:0}),[D,h]=r.useState(),[S,f]=r.useState(),[R,b]=r.useState(!1),j=(e,t)=>{b(!0),h(e),f(t)},A=e=>{b(!1),h(null),f(null)},F=e=>{_(t=>t===e?null:e)},M=e=>e.reduce((t,o)=>(t.totalNominal+=o.sum_nominal_on||0,t.totalPembayaran+=o.total_pembayaran||0,t),{totalNominal:0,totalPembayaran:0}),P=r.useMemo(()=>[{accessorKey:"unit",id:"collapse",cell:e=>e.getValue(),header:()=>"Unit",className:"lg:w-64 whitespace-nowrap w-auto",footer:e=>`TTL Wil ${s}`},{accessorKey:"sum_nominal_on",id:"sum_nominal_on",cell:e=>a(l,{value:e.getValue()}),header:()=>"Nominal",footer:e=>a(l,{value:u.totalNominal})},{accessorKey:"total_pembayaran",id:"total_pembayaran",cell:e=>a(l,{value:e.getValue()}),header:()=>"Saldo",footer:e=>a(l,{value:u.totalPembayaran})},{accessorKey:"sisa_goro",id:"sisa_goro",cell:e=>a(l,{value:e.getValue()}),header:()=>"Sisa"}],[u]);r.useEffect(()=>{if(s===null)return;const e=new AbortController;return(async()=>{try{const o=await x.get(route("goroumrah.requestWilayahTransaction"),{params:{wilayah:s,bulan:N.bulan},signal:e.signal});C(o.data.data);const B=M(o.data.data);v(B)}catch(o){x.isCancel(o)?console.log("Request canceled:",o.message):p(!1)}finally{p(!1)}})(),()=>{e.abort()}},[s]);const c=K({data:T,columns:P,getCoreRowModel:k(),debugTable:!0,debugHeaders:!0,debugColumns:!1});return m("div",{children:[m(U,{className:"text-xs lg:text-sm",children:[a(V,{children:c.getHeaderGroups().map(e=>a(n,{children:e.headers.map(t=>a(y,{className:"text-center",children:d(t.column.columnDef.header,t.getContext())},t.id))},e.id))}),a($,{children:w?a(n,{children:a(g,{colSpan:"4",children:"SILAHKAN TUNGGU DATA MASIH DIMUAT"})}):c.getRowModel().rows.length?c.getRowModel().rows.map((e,t)=>m(I.Fragment,{children:[a(n,{id:e.id,className:`${i==e.original.unit_id?"bg-gray-100 hover:bg-gray-200":""}`,children:e.getVisibleCells().map(o=>a(g,{className:`${o.column.columnDef.className}`,children:o.column.id=="collapse"?m("div",{className:"flex justify-center items-center gap-2",children:[a("div",{className:"flex-none lg:w-1/2 flex justify-end items-center",children:a("button",{onClick:()=>F(e.original.unit_id),className:`flex justify-center items-start hover:text-roman-500 ${i==e.original.unit_id?"rotate-90 text-roman-500":""} `,children:a(L,{})})}),a("div",{className:"grow w-auto flex items-center justify-start",children:a("button",{onClick:()=>j(e.original.unit_id,e.original.unit),className:"px-2 py-1 text-xs border border-gray-400 rounded hover:bg-gray-400 hover:text-white",children:d(o.column.columnDef.cell,o.getContext())})})]}):d(o.column.columnDef.cell,o.getContext())},o.id))},e.id),i==e.original.unit_id&&a(n,{className:"p-0 hover:bg-transparent",children:a(g,{colSpan:"5",className:"p-0 border-0",children:a(W,{triggerId:i})})},`newrow${e.id}`)]},e.id)):null}),a(G,{children:c.getFooterGroups().map(e=>a(n,{children:e.headers.map(t=>a(y,{className:"text-center bg-blue-400 text-black",children:d(t.column.columnDef.footer,t.getContext())},t.id))},e.id))})]}),a(q,{open:R,onClosed:A,triggeredId:D,triggeredBranch:S})]})};export{me as default};

import{q as I,r,j as a,a as m,R as K,c as x}from"./app-02daae82.js";import{F as l}from"./FormatNumbering-4321500b.js";import{u as U,T as V,a as $,b as n,c as y,f as d,d as G,e as g,g as k,h as q}from"./table-ece589a0.js";import{a as L}from"./index.esm-b32c738a.js";import E from"./DetailPerUnitGoro-149c52e0.js";import O from"./Create-71645071.js";import"./react-number-format.es-44e0fe2c.js";import"./utils-01642ffa.js";import"./iconBase-29f29ecf.js";import"./dayjs.min-ef1ffec7.js";import"./dialog-902129b6.js";import"./InputLabel-cf4d0354.js";import"./TextInput-0be98de0.js";import"./index.esm-4764c0db.js";import"./InputError-4b2065f7.js";import"./PrimaryButton-766ea5f3.js";import"./Loading-5377d93d.js";import"./transition-de6f9320.js";import"./SelectList-2b8f6e47.js";const ue=({triggerId:s})=>{const{server_filter:N,datas:T}=I().props,[C,w]=r.useState([]),[_,p]=r.useState(!0),[i,v]=r.useState(),[u,D]=r.useState({totalNominal:0,totalPembayaran:0}),[S,h]=r.useState(),[R,f]=r.useState(),[j,b]=r.useState(!1),A=(e,t)=>{b(!0),h(e),f(t)},M=e=>{b(!1),h(null),f(null)},P=e=>{v(t=>t===e?null:e)},B=e=>e.reduce((t,o)=>(t.totalNominal+=o.sum_nominal_on||0,t.totalPembayaran+=o.total_pembayaran||0,t),{totalNominal:0,totalPembayaran:0}),F=r.useMemo(()=>[{accessorKey:"unit",id:"collapse",cell:e=>e.getValue(),header:()=>"Unit",className:"lg:w-64 whitespace-nowrap w-auto",footer:e=>`TTL Wil ${s}`},{accessorKey:"sum_nominal_on",id:"sum_nominal_on",cell:e=>a(l,{value:e.getValue()}),header:()=>"Nominal",footer:e=>a(l,{value:u.totalNominal})},{accessorKey:"total_pembayaran",id:"total_pembayaran",cell:e=>a(l,{value:e.getValue()}),header:()=>"Saldo",footer:e=>a(l,{value:u.totalPembayaran})},{accessorKey:"sisa_goro",id:"sisa_goro",cell:e=>a(l,{value:e.getValue()}),header:()=>"Sisa"}],[u]);r.useEffect(()=>{if(s===null)return;const e=new AbortController;return(async()=>{try{const o=await x.get(route("goroumrah.requestWilayahTransaction"),{params:{wilayah:s,bulan:N.bulan},signal:e.signal});w(o.data.data);const H=B(o.data.data);D(H)}catch(o){x.isCancel(o)?console.log("Request canceled:",o.message):p(!1)}finally{p(!1)}})(),()=>{e.abort()}},[s,T]);const c=U({data:C,columns:F,getCoreRowModel:q(),debugTable:!0,debugHeaders:!0,debugColumns:!1});return m("div",{children:[m(V,{className:"text-xs lg:text-sm",children:[a($,{children:c.getHeaderGroups().map(e=>a(n,{children:e.headers.map(t=>a(y,{className:"text-center",children:d(t.column.columnDef.header,t.getContext())},t.id))},e.id))}),a(G,{children:_?a(n,{children:a(g,{colSpan:"4",children:"SILAHKAN TUNGGU DATA MASIH DIMUAT"})}):c.getRowModel().rows.length?c.getRowModel().rows.map((e,t)=>m(K.Fragment,{children:[a(n,{id:e.id,className:`${i==e.original.unit_id?"bg-gray-100 hover:bg-gray-200":""}`,children:e.getVisibleCells().map(o=>a(g,{className:`${o.column.columnDef.className}`,children:o.column.id=="collapse"?m("div",{className:"flex justify-center items-center gap-2",children:[a("div",{className:"flex-none lg:w-1/2 flex justify-end items-center",children:a("button",{onClick:()=>P(e.original.unit_id),className:`flex justify-center items-start hover:text-roman-500 ${i==e.original.unit_id?"rotate-90 text-roman-500":""} `,children:a(L,{})})}),a("div",{className:"grow w-auto flex items-center justify-start",children:a("button",{onClick:()=>A(e.original.unit_id,e.original.unit),className:"px-2 py-1 text-xs border border-gray-400 rounded hover:bg-gray-400 hover:text-white",children:d(o.column.columnDef.cell,o.getContext())})})]}):d(o.column.columnDef.cell,o.getContext())},o.id))},e.id),i==e.original.unit_id&&a(n,{className:"p-0 hover:bg-transparent",children:a(g,{colSpan:"5",className:"p-0 border-0",children:a(E,{triggerId:i})})},`newrow${e.id}`)]},e.id)):null}),a(k,{children:c.getFooterGroups().map(e=>a(n,{children:e.headers.map(t=>a(y,{className:"text-center bg-blue-400 text-black",children:d(t.column.columnDef.footer,t.getContext())},t.id))},e.id))})]}),a(O,{open:j,onClosed:M,triggeredId:S,triggeredBranch:R})]})};export{ue as default};

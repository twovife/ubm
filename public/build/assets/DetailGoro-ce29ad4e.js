import{W as I,r,j as a,a as m,R as K,b as x}from"./app-66cb5542.js";import{F as l}from"./FormatNumbering-aa26b2ef.js";import{u as U,T as V,a as $,b as n,c as y,f as d,d as G,e as g,i as k,g as L}from"./index-7d2e7be8.js";import{F as W}from"./index.esm-07fbca0e.js";import q from"./DetailPerUnitGoro-b66d35c4.js";import E from"./Create-f8e4c5f8.js";import"./react-number-format.es-8e0a123c.js";import"./utils-01642ffa.js";import"./iconBase-b3a06d45.js";import"./dayjs.min-9c519b5c.js";import"./dialog-846a8d61.js";import"./InputLabel-d70115a7.js";import"./TextInput-7da1376d.js";import"./index.esm-ca1f291a.js";import"./InputError-4989f8c3.js";import"./PrimaryButton-e6e3700f.js";import"./Loading-b802964d.js";import"./transition-00bda6a6.js";const de=({triggerId:s})=>{const{server_filter:N,datas:T}=I().props,[C,w]=r.useState([]),[_,p]=r.useState(!0),[i,v]=r.useState(),[u,D]=r.useState({totalNominal:0,totalPembayaran:0}),[S,h]=r.useState(),[R,f]=r.useState(),[j,b]=r.useState(!1),A=(e,t)=>{b(!0),h(e),f(t)},F=e=>{b(!1),h(null),f(null)},M=e=>{v(t=>t===e?null:e)},P=e=>e.reduce((t,o)=>(t.totalNominal+=o.sum_nominal_on||0,t.totalPembayaran+=o.total_pembayaran||0,t),{totalNominal:0,totalPembayaran:0}),B=r.useMemo(()=>[{accessorKey:"unit",id:"collapse",cell:e=>e.getValue(),header:()=>"Unit",className:"lg:w-64 whitespace-nowrap w-auto",footer:e=>`TTL Wil ${s}`},{accessorKey:"sum_nominal_on",id:"sum_nominal_on",cell:e=>a(l,{value:e.getValue()}),header:()=>"Nominal",footer:e=>a(l,{value:u.totalNominal})},{accessorKey:"total_pembayaran",id:"total_pembayaran",cell:e=>a(l,{value:e.getValue()}),header:()=>"Saldo",footer:e=>a(l,{value:u.totalPembayaran})},{accessorKey:"sisa_goro",id:"sisa_goro",cell:e=>a(l,{value:e.getValue()}),header:()=>"Sisa"}],[u]);r.useEffect(()=>{if(s===null)return;const e=new AbortController;return(async()=>{try{const o=await x.get(route("goroumrah.requestWilayahTransaction"),{params:{wilayah:s,bulan:N.bulan},signal:e.signal});w(o.data.data);const H=P(o.data.data);D(H)}catch(o){x.isCancel(o)?console.log("Request canceled:",o.message):p(!1)}finally{p(!1)}})(),()=>{e.abort()}},[s,T]);const c=U({data:C,columns:B,getCoreRowModel:L(),debugTable:!0,debugHeaders:!0,debugColumns:!1});return m("div",{children:[m(V,{className:"text-xs lg:text-sm",children:[a($,{children:c.getHeaderGroups().map(e=>a(n,{children:e.headers.map(t=>a(y,{className:"text-center",children:d(t.column.columnDef.header,t.getContext())},t.id))},e.id))}),a(G,{children:_?a(n,{children:a(g,{colSpan:"4",children:"SILAHKAN TUNGGU DATA MASIH DIMUAT"})}):c.getRowModel().rows.length?c.getRowModel().rows.map((e,t)=>m(K.Fragment,{children:[a(n,{id:e.id,className:`${i==e.original.unit_id?"bg-gray-100 hover:bg-gray-200":""}`,children:e.getVisibleCells().map(o=>a(g,{className:`${o.column.columnDef.className}`,children:o.column.id=="collapse"?m("div",{className:"flex justify-center items-center gap-2",children:[a("div",{className:"flex-none lg:w-1/2 flex justify-end items-center",children:a("button",{onClick:()=>M(e.original.unit_id),className:`flex justify-center items-start hover:text-roman-500 ${i==e.original.unit_id?"rotate-90 text-roman-500":""} `,children:a(W,{})})}),a("div",{className:"grow w-auto flex items-center justify-start",children:a("button",{onClick:()=>A(e.original.unit_id,e.original.unit),className:"px-2 py-1 text-xs border border-gray-400 rounded hover:bg-gray-400 hover:text-white",children:d(o.column.columnDef.cell,o.getContext())})})]}):d(o.column.columnDef.cell,o.getContext())},o.id))},e.id),i==e.original.unit_id&&a(n,{className:"p-0 hover:bg-transparent",children:a(g,{colSpan:"5",className:"p-0 border-0",children:a(q,{triggerId:i})})},`newrow${e.id}`)]},e.id)):null}),a(k,{children:c.getFooterGroups().map(e=>a(n,{children:e.headers.map(t=>a(y,{className:"text-center bg-blue-400 text-black",children:d(t.column.columnDef.footer,t.getContext())},t.id))},e.id))})]}),a(E,{open:j,onClosed:F,triggeredId:S,triggeredBranch:R})]})};export{de as default};
